<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0d1b2a">
  <title>Acknowledgement of Receipt — ADV Teammate Handbook</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=DM+Serif+Display&family=Dancing+Script:wght@400;600&family=Great+Vibes&family=Pacifico&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root {
      --navy-950: #060e1a;
      --navy-900: #0d1b2a;
      --navy-800: #1b2d4a;
      --navy-700: #243b5e;
      --navy-600: #2e4a72;
      --blue-500: #4a90c4;
      --blue-400: #6aaddb;
      --blue-300: #7cb9d8;
      --blue-200: #a3d5e8;
      --blue-100: #d4ecf5;
      --blue-50: #eef7fb;
      --slate-50: #f8fafc;
      --slate-100: #f1f5f9;
      --slate-200: #e2e8f0;
      --slate-300: #cbd5e1;
      --slate-400: #94a3b8;
      --slate-500: #64748b;
      --slate-600: #475569;
      --slate-700: #334155;
      --slate-800: #1e293b;
      --slate-900: #0f172a;
      --white: #ffffff;
      --red-500: #ef4444;
      --green-500: #22c55e;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Plus Jakarta Sans', -apple-system, sans-serif;
      background: var(--navy-950);
      color: var(--slate-800);
      line-height: 1.6;
      min-height: 100vh;
    }

    .header {
      background: linear-gradient(135deg, var(--navy-950) 0%, var(--navy-900) 50%, var(--navy-800) 100%);
      padding: 2rem 2rem;
      text-align: center;
      position: relative;
      overflow: hidden;
      border-bottom: 1px solid rgba(74,144,196,0.15);
    }
    .header::before {
      content: '';
      position: absolute; top: -60%; right: -10%;
      width: 400px; height: 400px;
      background: radial-gradient(circle, rgba(74,144,196,0.08) 0%, transparent 70%);
      border-radius: 50%; pointer-events: none;
    }
    .header-inner {
      max-width: 720px; margin: 0 auto;
      position: relative; z-index: 1;
    }
    .header-nav {
      display: flex; align-items: center; justify-content: center;
      gap: 0.75rem; margin-bottom: 1.5rem;
    }
    .header-nav a {
      display: inline-flex; align-items: center; gap: 0.4rem;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-size: 0.82rem; font-weight: 600;
      text-decoration: none;
      transition: all 0.2s ease;
    }
    .header-nav a.back-link {
      background: rgba(74,144,196,0.1);
      color: var(--blue-300);
      border: 1px solid rgba(74,144,196,0.2);
    }
    .header-nav a.back-link:hover { background: rgba(74,144,196,0.18); }
    .header-nav a svg { width: 14px; height: 14px; }
    .header-logo {
      height: clamp(40px, 7vw, 56px);
      max-width: 70vw;
      object-fit: contain;
      margin-bottom: 1rem;
    }
    .header h1 {
      font-family: 'DM Serif Display', serif;
      font-size: clamp(1.3rem, 3.5vw, 1.75rem);
      font-weight: 400;
      color: var(--white);
      margin-bottom: 0.35rem;
    }
    .header p { color: var(--slate-400); font-size: 0.85rem; }

    .container { max-width: 720px; margin: 0 auto; padding: 2rem 1.5rem 4rem; }

    .download-card {
      background: var(--navy-900);
      border: 1px solid rgba(74,144,196,0.15);
      border-radius: 12px;
      padding: 1.25rem 1.5rem;
      margin-bottom: 1.5rem;
      display: flex; align-items: center; gap: 1rem;
      transition: border-color 0.2s ease;
    }
    .download-card:hover { border-color: rgba(74,144,196,0.3); }
    .download-icon {
      flex-shrink: 0;
      width: 48px; height: 48px;
      background: rgba(74,144,196,0.1);
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
    }
    .download-icon svg { width: 24px; height: 24px; color: var(--blue-400); }
    .download-info { flex: 1; }
    .download-info h3 { font-size: 0.9rem; font-weight: 600; color: var(--white); margin-bottom: 0.1rem; }
    .download-info p { font-size: 0.78rem; color: var(--slate-500); }
    .download-btn {
      flex-shrink: 0;
      display: inline-flex; align-items: center; gap: 0.4rem;
      background: var(--blue-500); color: var(--white);
      text-decoration: none;
      font-size: 0.82rem; font-weight: 600;
      padding: 0.55rem 1.1rem; border-radius: 8px;
      transition: background 0.2s ease;
    }
    .download-btn:hover { background: var(--blue-400); }
    .download-btn svg { width: 14px; height: 14px; }

    .card {
      background: var(--navy-900);
      border: 1px solid rgba(74,144,196,0.12);
      border-radius: 12px;
      padding: 1.75rem 1.5rem;
      margin-bottom: 1.5rem;
    }
    .card h2 {
      font-family: 'DM Serif Display', serif;
      font-size: 1.25rem;
      font-weight: 400;
      color: var(--white);
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid rgba(74,144,196,0.15);
    }
    .ack-text { font-size: 0.88rem; line-height: 1.8; color: var(--slate-300); }
    .ack-text p { margin-bottom: 0.85rem; }
    .ack-text p:last-child { margin-bottom: 0; }

    .form-row { margin-bottom: 1.25rem; }
    .form-row label {
      display: block;
      font-size: 0.75rem; font-weight: 700;
      color: var(--slate-400);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 0.4rem;
    }
    .form-row input[type="text"],
    .form-row input[type="date"] {
      width: 100%;
      padding: 0.7rem 0.9rem;
      font-family: inherit; font-size: 0.92rem;
      color: var(--white);
      background: rgba(255,255,255,0.05);
      border: 1.5px solid rgba(74,144,196,0.2);
      border-radius: 8px;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .form-row input::placeholder { color: var(--slate-600); }
    .form-row input:focus {
      border-color: var(--blue-500);
      box-shadow: 0 0 0 3px rgba(74,144,196,0.15);
    }
    /* Fix date input color for dark theme */
    .form-row input[type="date"]::-webkit-calendar-picker-indicator {
      filter: invert(0.7);
    }
    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    @media (max-width: 540px) { .form-grid { grid-template-columns: 1fr; } }

    .sig-container { position: relative; }
    .sig-canvas {
      width: 100%; height: 160px;
      background: rgba(255,255,255,0.03);
      border: 1.5px solid rgba(74,144,196,0.2);
      border-radius: 8px;
      cursor: crosshair; touch-action: none;
      transition: border-color 0.2s;
    }
    .sig-canvas.disabled { cursor: not-allowed; pointer-events: none; opacity: 0.7; }
    .sig-canvas.locked { pointer-events: none; }
    .sig-canvas.active { border-color: var(--blue-500); box-shadow: 0 0 0 3px rgba(74,144,196,0.15); }
    .sig-canvas.has-signature { border-color: var(--blue-500); }
    .sig-placeholder {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      color: var(--slate-600); font-size: 0.82rem;
      pointer-events: none;
      transition: opacity 0.2s;
    }
    .sig-placeholder.hidden { opacity: 0; }
    .sig-line {
      position: absolute; bottom: 36px; left: 20px; right: 20px;
      height: 1px; background: rgba(74,144,196,0.15);
      pointer-events: none;
    }
    .sig-clear {
      position: absolute; top: 8px; right: 8px;
      background: var(--navy-800);
      border: 1px solid rgba(74,144,196,0.2);
      border-radius: 6px;
      padding: 0.25rem 0.55rem;
      font-size: 0.7rem; font-weight: 600;
      color: var(--slate-500);
      cursor: pointer;
      opacity: 0; transition: opacity 0.2s, color 0.15s;
    }
    .sig-clear.visible { opacity: 1; }
    .sig-clear:hover { color: var(--red-500); }

    .sig-controls {
      display: grid; gap: 0.75rem;
      margin-bottom: 1rem;
    }
    .sig-toggle {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 0.6rem;
    }
    .sig-option {
      background: rgba(74,144,196,0.08);
      border: 1px solid rgba(74,144,196,0.2);
      border-radius: 10px;
      padding: 0.6rem 0.75rem;
      display: flex; align-items: center; justify-content: space-between;
      font-size: 0.8rem; font-weight: 600; color: var(--slate-300);
      cursor: pointer; transition: all 0.15s ease;
    }
    .sig-option.active { background: rgba(74,144,196,0.2); color: var(--white); border-color: rgba(74,144,196,0.4); }
    .sig-row {
      display: flex; flex-wrap: wrap; gap: 0.75rem; align-items: center;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(74,144,196,0.15);
      border-radius: 10px;
      padding: 0.75rem;
    }
    .sig-row label { font-size: 0.72rem; letter-spacing: 0.05em; text-transform: uppercase; color: var(--slate-500); }
    .sig-ink {
      display: flex; align-items: center; gap: 0.5rem;
    }
    .sig-color {
      width: 30px; height: 30px; border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.3);
      cursor: pointer; transition: transform 0.15s ease, border-color 0.15s ease;
    }
    .sig-color.active { border-color: var(--white); transform: scale(1.05); }
    .sig-size input[type="range"] { width: 140px; }
    .sig-action-btn {
      padding: 0.5rem 0.9rem; border-radius: 8px; border: 1px solid rgba(74,144,196,0.25);
      background: rgba(74,144,196,0.15); color: var(--white); font-weight: 600;
      cursor: pointer; transition: background 0.15s ease;
    }
    .sig-action-btn.secondary { background: rgba(255,255,255,0.05); color: var(--slate-300); }
    .sig-action-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .sig-typed-controls { display: grid; gap: 0.5rem; width: 100%; }
    .sig-typed-controls input, .sig-typed-controls select {
      width: 100%; padding: 0.6rem 0.75rem;
      border-radius: 8px; border: 1px solid rgba(74,144,196,0.2);
      background: rgba(255,255,255,0.04); color: var(--white);
      font-family: inherit; font-size: 0.9rem;
    }
    .sig-hint {
      font-size: 0.75rem; color: var(--slate-500);
      margin-top: 0.4rem;
    }
    .sig-hidden { display: none !important; }

    .consent-row {
      margin: 1.5rem 0 1.25rem;
      display: flex; align-items: flex-start; gap: 0.75rem;
    }
    .consent-row input[type="checkbox"] {
      flex-shrink: 0;
      width: 20px; height: 20px;
      margin-top: 2px;
      accent-color: var(--blue-500);
      cursor: pointer;
    }
    .consent-row label {
      font-size: 0.85rem; color: var(--slate-300);
      line-height: 1.5; cursor: pointer;
      text-transform: none; letter-spacing: normal; font-weight: 400;
    }
    .consent-row label strong { font-weight: 700; color: var(--blue-300); }

    .submit-btn {
      width: 100%;
      padding: 0.85rem 1.5rem;
      font-family: inherit; font-size: 1rem; font-weight: 700;
      color: var(--white);
      background: var(--blue-500);
      border: none; border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s, opacity 0.2s;
    }
    .submit-btn:hover:not(:disabled) { background: var(--blue-400); }
    .submit-btn:active:not(:disabled) { transform: scale(0.99); }
    .submit-btn:disabled { opacity: 0.4; cursor: not-allowed; }

    .error-msg { font-size: 0.75rem; color: var(--red-500); margin-top: 0.3rem; display: none; }
    .form-row.error input, .form-row.error .sig-canvas { border-color: var(--red-500) !important; }
    .form-row.error .error-msg { display: block; }

    /* Save Overlay */
    .save-overlay {
      display: none;
      position: fixed; inset: 0;
      background: rgba(6,14,26,0.75);
      backdrop-filter: blur(8px);
      z-index: 100;
      align-items: center; justify-content: center;
      animation: fadeIn 0.3s ease;
    }
    .save-overlay.show { display: flex; }
    .save-card {
      background: var(--navy-900);
      border: 1px solid rgba(74,144,196,0.2);
      border-radius: 16px;
      padding: 2.5rem 2rem;
      text-align: center;
      max-width: 480px; width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      animation: slideUp 0.4s ease;
    }
    .save-icon {
      width: 64px; height: 64px;
      background: rgba(34,197,94,0.12);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 1.25rem;
    }
    .save-icon svg { width: 32px; height: 32px; color: var(--green-500); }
    .save-card h3 {
      font-family: 'DM Serif Display', serif;
      font-size: 1.3rem; font-weight: 400;
      color: var(--white);
      margin-bottom: 0.5rem;
    }
    .save-card > p { font-size: 0.88rem; color: var(--slate-400); margin-bottom: 1.5rem; line-height: 1.6; }
    .signer-detail {
      font-size: 0.8rem; color: var(--slate-400);
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(74,144,196,0.1);
      border-radius: 8px;
      padding: 0.75rem 1rem;
      margin-bottom: 1.5rem;
      text-align: left;
    }
    .signer-detail span { display: block; margin-bottom: 0.2rem; }
    .signer-detail strong { color: var(--slate-300); }

    .save-buttons { display: flex; flex-direction: column; gap: 0.75rem; }
    .save-btn {
      display: flex; align-items: center; justify-content: center; gap: 0.6rem;
      padding: 0.8rem 1.5rem;
      border-radius: 10px;
      font-family: inherit; font-size: 0.92rem; font-weight: 600;
      cursor: pointer; border: none;
      transition: all 0.2s ease;
      text-decoration: none;
    }
    .save-btn svg { width: 20px; height: 20px; flex-shrink: 0; }
    .save-btn.onedrive { background: #0078d4; color: var(--white); }
    .save-btn.onedrive:hover { background: #106ebe; }
    .save-btn.download {
      background: rgba(255,255,255,0.06);
      color: var(--slate-300);
      border: 1px solid rgba(74,144,196,0.2);
    }
    .save-btn.download:hover { background: rgba(255,255,255,0.1); }
    .save-btn.done {
      background: transparent;
      color: var(--slate-500);
      font-size: 0.82rem; font-weight: 500;
      padding: 0.5rem;
    }
    .save-btn.done:hover { color: var(--slate-300); }
    .onedrive-status { font-size: 0.75rem; color: var(--slate-500); margin-top: 0.2rem; font-style: italic; }

    #hiddenFileInput { display: none; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    .footer {
      text-align: center;
      padding: 2rem 1rem;
      font-size: 0.75rem;
      color: var(--slate-600);
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(74,144,196,0.2); border-radius: 3px; }

    @media print {
      body { background: white; color: #1e293b; }
      .download-card, .submit-btn, .sig-clear, .consent-row, .header-nav { display: none !important; }
      .card { box-shadow: none; border: 1px solid #ccc; background: white; }
      .card h2 { color: #0d1b2a; border-color: #ddd; }
      .ack-text { color: #334155; }
    }

    /* ═══════ MOBILE ═══════ */
    @media (max-width: 640px) {
      body { -webkit-tap-highlight-color: transparent; }
      .header { padding: 1.5rem 1rem; padding-top: max(1.5rem, env(safe-area-inset-top)); }
      .header-logo { max-height: 44px; }
      .header h1 { font-size: 1.25rem; }
      .header-nav a { font-size: 0.8rem; padding: 0.55rem 0.85rem; }
      .container { padding: 1.25rem 0.75rem 3rem; }

      .download-card { padding: 1rem; gap: 0.75rem; flex-wrap: wrap; }
      .download-icon { width: 42px; height: 42px; }
      .download-info h3 { font-size: 0.85rem; }
      .download-btn { font-size: 0.8rem; padding: 0.5rem 0.9rem; }

      .card { padding: 1.25rem 1rem; }
      .card h2 { font-size: 1.1rem; }
      .ack-text { font-size: 0.84rem; line-height: 1.75; }

      .form-row input[type="text"],
      .form-row input[type="date"] {
        padding: 0.8rem 0.9rem;
        font-size: 1rem; /* 16px prevents iOS zoom on focus */
      }
      .sig-canvas { height: 140px; }
      .consent-row label { font-size: 0.82rem; }
      .submit-btn { padding: 0.9rem 1.5rem; font-size: 0.95rem; }

      .save-card { padding: 2rem 1.25rem; width: 95%; }
      .save-card h3 { font-size: 1.15rem; }
      .save-btn { padding: 0.85rem 1rem; font-size: 0.88rem; }
    }

    @media (max-width: 380px) {
      .header { padding: 1.25rem 0.75rem; }
      .header-logo { max-height: 36px; }
      .container { padding: 1rem 0.5rem 2.5rem; }
      .card { padding: 1rem 0.75rem; }
      .download-card { flex-direction: column; text-align: center; }
      .download-info { text-align: left; width: 100%; }
      .download-btn { align-self: stretch; justify-content: center; }
    }

    button, a, input[type="checkbox"] { touch-action: manipulation; }
  </style>
</head>
<body>

  <header class="header">
    <div class="header-inner">
      <nav class="header-nav">
        <a href="index.html" class="back-link" onclick="returnToHandbook(event)">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5"/></svg>
          Back to Handbook
        </a>
      </nav>
      <img src="logo.png" alt="The Retail Odyssey Company" class="header-logo">
      <h1>Teammate Handbook Acknowledgement</h1>
      <p>Revised February 2025 &nbsp;·&nbsp; Please review, sign, and submit</p>
    </div>
  </header>

  <main class="container">
    <div class="download-card">
      <div class="download-icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.8" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"/></svg>
      </div>
      <div class="download-info">
        <h3>ADV Teammate Handbook</h3>
        <p>PDF &nbsp;·&nbsp; 56 pages &nbsp;·&nbsp; Revised Feb 2025</p>
      </div>
      <a href="2025_Teammate_Handbook.pdf" target="_blank" class="download-btn" download>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"/></svg>
        Download
      </a>
    </div>

    <section class="card">
      <h2>Acknowledgement of Receipt</h2>
      <div class="ack-text">
        <p>I have received a copy of the Company's Handbook and the applicable Supplement(s) for the locations in which I work. I agree to read it and to comply with the policies and procedures described in the Handbook and Supplement(s). If I have any questions regarding any of the Handbook's provisions, I will consult with my supervisor, manager or Human Resources. I understand that if I do not follow the policies and procedures contained herein that I may be subject to disciplinary action, up to and including termination of employment.</p>
        <p>I also understand that this Handbook is the most up-to-date version of the Company's policies and procedures and replaces any prior written and oral communications about the subjects contained in it.</p>
        <p>I acknowledge that my employment relationship with the Company is "at-will", meaning that, regardless of anything contained in this Handbook and regardless of any custom or practice, either I or the Company may terminate my employment at any time, for any reason or no reason, with or without cause, and with or without procedural requirements. I understand that no representatives of the Company, other than the CEO in a writing signed by him/her/them, may enter into any agreements, or make any representations, written or oral, to alter my at-will status or otherwise create any contractual obligation between me and the Company.</p>
        <p>I further acknowledge that this handbook and the policies contained herein are not intended to create (and shall not be construed as creating) a contract (express or implied) for employment between the Company and any Teammate and that said policies can be modified by the Company at any time, with or without notice to me, in its sole and absolute discretion.</p>
        <p>By signing below, I acknowledge that I have received and will abide by the Company's Handbook and all the policies within it, including those on harassment, discrimination, retaliation, and bringing complaints regarding the same.</p>
      </div>
    </section>

    <section class="card">
      <h2>Sign Below</h2>
      <div class="form-row" id="nameRow">
        <label for="printedName">Printed Teammate Name</label>
        <input type="text" id="printedName" placeholder="Enter your full legal name" autocomplete="name">
        <div class="error-msg">Please enter your full name.</div>
      </div>
      <div class="form-row" id="sigRow">
        <label>Teammate Signature</label>
        <div class="sig-controls">
          <div class="sig-toggle">
            <button type="button" class="sig-option active" data-mode="draw" onclick="setSignatureMode('draw')">Draw</button>
            <button type="button" class="sig-option" data-mode="type" onclick="setSignatureMode('type')">Type</button>
            <button type="button" class="sig-option" data-mode="upload" onclick="setSignatureMode('upload')">Upload</button>
            <button type="button" class="sig-option" data-mode="fax" onclick="setSignatureMode('fax')">Fax to Store</button>
          </div>
          <div class="sig-row" id="drawControls">
            <button type="button" class="sig-action-btn" id="signNowBtn" onclick="enableSignaturePad()">Sign Now</button>
            <div class="sig-ink">
              <label>Ink</label>
              <button type="button" class="sig-color active" id="inkBlack" title="Black ink" style="background:#0f172a;" onclick="setInkColor('#0f172a')"></button>
              <button type="button" class="sig-color" id="inkBlue" title="Blue ink" style="background:#1d4ed8;" onclick="setInkColor('#1d4ed8')"></button>
            </div>
            <div class="sig-size">
              <label for="penSize">Point</label>
              <input type="range" id="penSize" min="1" max="6" step="0.5" value="2">
            </div>
          </div>
          <div class="sig-row sig-hidden" id="typeControls">
            <div class="sig-typed-controls">
              <label for="typedSignature">Type Your Signature</label>
              <input type="text" id="typedSignature" placeholder="Enter your full signature">
            </div>
            <div class="sig-typed-controls">
              <label for="typedFont">Signature Font</label>
              <select id="typedFont">
                <option value="'Dancing Script', cursive">Dancing Script</option>
                <option value="'Great Vibes', cursive">Great Vibes</option>
                <option value="'Pacifico', cursive">Pacifico</option>
              </select>
            </div>
            <button type="button" class="sig-action-btn secondary" onclick="applyTypedSignature()">Apply Signature</button>
          </div>
          <div class="sig-row sig-hidden" id="uploadControls">
            <div>
              <label>Upload Signature Image</label>
              <div class="sig-hint">PNG or JPG works best with a transparent or light background.</div>
            </div>
            <button type="button" class="sig-action-btn" onclick="triggerSignatureUpload()">Choose Image</button>
          </div>
          <div class="sig-row sig-hidden" id="faxControls">
            <div class="sig-typed-controls">
              <label for="faxStore">Select Fred Meyer Store</label>
              <select id="faxStore">
                <option value="">Choose a store number</option>
                <option>5</option><option>11</option><option>13</option><option>17</option><option>18</option><option>19</option>
                <option>21</option><option>23</option><option>24</option><option>25</option><option>28</option><option>30</option>
                <option>31</option><option>35</option><option>40</option><option>41</option><option>49</option><option>50</option>
                <option>53</option><option>60</option><option>63</option><option>70</option><option>71</option><option>75</option>
                <option>90</option><option>93</option><option>111</option><option>122</option><option>125</option><option>126</option>
                <option>127</option><option>135</option><option>140</option><option>143</option><option>150</option><option>153</option>
                <option>156</option><option>158</option><option>163</option><option>165</option><option>171</option><option>180</option>
                <option>185</option><option>186</option><option>195</option><option>196</option><option>198</option><option>208</option>
                <option>209</option><option>210</option><option>214</option><option>215</option><option>218</option><option>220</option>
                <option>224</option><option>225</option><option>226</option><option>227</option><option>236</option><option>240</option>
                <option>242</option><option>253</option><option>255</option><option>260</option><option>265</option><option>281</option>
                <option>285</option><option>286</option><option>325</option><option>328</option><option>351</option><option>355</option>
                <option>360</option><option>372</option><option>375</option><option>377</option><option>383</option><option>390</option>
                <option>391</option><option>393</option><option>417</option><option>424</option><option>439</option><option>449</option>
                <option>457</option><option>458</option><option>459</option><option>460</option><option>462</option><option>464</option>
                <option>482</option><option>485</option><option>486</option><option>516</option><option>600</option><option>603</option>
                <option>604</option><option>605</option><option>608</option><option>613</option><option>614</option><option>615</option>
                <option>649</option><option>650</option><option>651</option><option>652</option><option>653</option><option>654</option>
                <option>655</option><option>656</option><option>657</option><option>658</option><option>659</option><option>660</option>
                <option>661</option><option>662</option><option>663</option><option>665</option><option>667</option><option>668</option>
                <option>681</option><option>682</option><option>683</option><option>685</option><option>688</option><option>691</option>
                <option>694</option>
              </select>
            </div>
            <div class="sig-hint">We will route a fax-ready acknowledgement to your selected store.</div>
          </div>
        </div>
        <div class="sig-container">
          <canvas id="sigCanvas" class="sig-canvas"></canvas>
          <div class="sig-line"></div>
          <span id="sigPlaceholder" class="sig-placeholder">Sign here using your mouse or finger</span>
          <button type="button" id="sigClear" class="sig-clear" onclick="clearSignature()">Clear</button>
        </div>
        <div class="sig-hint" id="orientationHint">Tip: rotate your device for more signing space.</div>
        <div class="error-msg" id="sigError">Please provide your signature above.</div>
      </div>
      <div class="form-grid">
        <div class="form-row" id="dateRow">
          <label for="signDate">Date</label>
          <input type="date" id="signDate">
          <div class="error-msg">Please select today's date.</div>
        </div>
      </div>
      <div class="consent-row">
        <input type="checkbox" id="digiConsent">
        <label for="digiConsent" id="consentLabel">By checking this box, I agree that my digital signature above (or uploaded signature image) is the legal equivalent of my handwritten signature and that I intend to be bound by this acknowledgement. I confirm I have <strong>reviewed the ADV Teammate Handbook and my State Supplement</strong> and understand the policies and procedures described within them.</label>
      </div>
      <button type="button" class="submit-btn" id="submitBtn" disabled onclick="handleSubmit()">Submit Acknowledgement</button>
    </section>
  </main>

  <footer class="footer">&copy; 2025 Advantage Solutions Inc. &nbsp;·&nbsp; All rights reserved.</footer>

  <input type="file" id="hiddenFileInput" accept=".pdf">
  <input type="file" id="sigFileInput" accept="image/*">

  <div class="save-overlay" id="saveOverlay">
    <div class="save-card">
      <div class="save-icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"/></svg>
      </div>
      <h3>Acknowledgement Signed</h3>
      <p>Your signed acknowledgement PDF is ready. Choose how to save it.</p>
      <div class="signer-detail" id="signerDetail"></div>
      <div class="save-buttons">
        <button class="save-btn onedrive" id="onedriveSaveBtn" onclick="saveToOneDrive()">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12.39 4.19c1.66-.89 3.73-.78 5.28.32a5.17 5.17 0 0 1 2.2 3.54 4.38 4.38 0 0 1 2.67 1.81 4.34 4.34 0 0 1 .72 3.1 4.36 4.36 0 0 1-1.67 2.85 4.4 4.4 0 0 1-3.14.94H6.13a5.07 5.07 0 0 1-3.55-1.38A4.91 4.91 0 0 1 1.1 12a4.94 4.94 0 0 1 2.1-3.07 5.03 5.03 0 0 1 3.56-.85c.54-1.71 1.78-3.07 3.43-3.59a5.89 5.89 0 0 1 2.2-.3Z"/></svg>
          Save to OneDrive
        </button>
        <div class="onedrive-status" id="onedriveStatus"></div>
        <button class="save-btn download" id="downloadBtn" onclick="downloadPDF()">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"/></svg>
          Download PDF to Device
        </button>
        <button class="save-btn done" onclick="closeSaveOverlay()">Close</button>
      </div>
    </div>
  </div>

  <script>
    const ONEDRIVE_CLIENT_ID = '';

    function returnToHandbook(e) {
      if (e) e.preventDefault();
      const lastPage = localStorage.getItem('handbookLastPage');
      const lastView = localStorage.getItem('handbookLastView');
      const url = lastView === 'reader' && lastPage ? `index.html#page=${lastPage}` : 'index.html';
      window.location.href = url;
    }

    /* ═══════════════════════════════════════════════════════════
       SIGNATURE PAD
       ═══════════════════════════════════════════════════════════ */
    const canvas = document.getElementById('sigCanvas');
    const ctx = canvas.getContext('2d');
    const placeholder = document.getElementById('sigPlaceholder');
    const clearBtn = document.getElementById('sigClear');
    const signNowBtn = document.getElementById('signNowBtn');
    const orientationHint = document.getElementById('orientationHint');
    const penSizeInput = document.getElementById('penSize');
    const typedInput = document.getElementById('typedSignature');
    const typedFont = document.getElementById('typedFont');
    const sigFileInput = document.getElementById('sigFileInput');
    const faxStore = document.getElementById('faxStore');
    const consentLabel = document.getElementById('consentLabel');

    let drawing = false;
    let hasSig = false;
    let signatureMode = 'draw';
    let signatureEnabled = false;
    let signatureLocked = false;
    let signatureColor = '#0f172a';
    let signatureImage = '';

    function resizeCanvas(preserve = true) {
      const rect = canvas.getBoundingClientRect();
      const dpr = window.devicePixelRatio || 1;
      const previousImage = preserve ? signatureImage : '';
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      ctx.lineWidth = parseFloat(penSizeInput.value);
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      ctx.strokeStyle = signatureColor;
      if (previousImage) restoreSignatureImage(previousImage);
    }

    function restoreSignatureImage(dataUrl) {
      const img = new Image();
      img.onload = () => {
        const rect = canvas.getBoundingClientRect();
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0, rect.width, rect.height);
      };
      img.src = dataUrl;
    }

    function updateOrientationHint() {
      const isPortrait = window.matchMedia('(orientation: portrait)').matches;
      const showHint = signatureMode === 'draw' && !hasSig && window.innerWidth <= 900 && isPortrait;
      orientationHint.classList.toggle('sig-hidden', !showHint);
    }

    function setSignatureMode(mode) {
      if (signatureLocked) return;
      signatureMode = mode;
      document.querySelectorAll('.sig-option').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.mode === mode);
      });
      document.getElementById('drawControls').classList.toggle('sig-hidden', mode !== 'draw');
      document.getElementById('typeControls').classList.toggle('sig-hidden', mode !== 'type');
      document.getElementById('uploadControls').classList.toggle('sig-hidden', mode !== 'upload');
      document.getElementById('faxControls').classList.toggle('sig-hidden', mode !== 'fax');
      placeholder.textContent = mode === 'draw' ? 'Sign here using your mouse or finger' : 'Signature preview will appear here';
      consentLabel.textContent = mode === 'fax'
        ? 'By checking this box, I confirm I have reviewed the ADV Teammate Handbook and my State Supplement and request this acknowledgement be faxed to my selected store.'
        : 'By checking this box, I agree that my digital signature above (or uploaded signature image) is the legal equivalent of my handwritten signature and that I intend to be bound by this acknowledgement. I confirm I have reviewed the ADV Teammate Handbook and my State Supplement and understand the policies and procedures described within them.';
      signatureEnabled = mode !== 'draw';
      signNowBtn.disabled = mode !== 'draw' || signatureEnabled;
      canvas.classList.toggle('disabled', mode === 'fax' || (mode === 'draw' && !signatureEnabled));
      if (mode === 'fax') {
        clearSignature();
      }
      updateOrientationHint();
      checkForm();
    }

    function setInkColor(color) {
      signatureColor = color;
      ctx.strokeStyle = signatureColor;
      document.getElementById('inkBlack').classList.toggle('active', color === '#0f172a');
      document.getElementById('inkBlue').classList.toggle('active', color === '#1d4ed8');
      if (signatureMode === 'type' && typedInput.value.trim()) applyTypedSignature();
    }

    function enableSignaturePad() {
      if (signatureLocked) return;
      signatureEnabled = true;
      canvas.classList.remove('disabled');
      signNowBtn.disabled = true;
      updateOrientationHint();
    }

    function getPos(e) {
      const rect = canvas.getBoundingClientRect();
      const cx = e.touches ? e.touches[0].clientX : e.clientX;
      const cy = e.touches ? e.touches[0].clientY : e.clientY;
      return { x: cx - rect.left, y: cy - rect.top };
    }

    function startDraw(e) {
      if (signatureLocked || signatureMode !== 'draw' || !signatureEnabled) return;
      e.preventDefault();
      drawing = true;
      canvas.classList.add('active');
      const p = getPos(e);
      ctx.beginPath();
      ctx.moveTo(p.x, p.y);
    }

    function draw(e) {
      if (!drawing || signatureLocked) return;
      e.preventDefault();
      const p = getPos(e);
      ctx.lineTo(p.x, p.y);
      ctx.stroke();
      if (!hasSig) {
        hasSig = true;
        placeholder.classList.add('hidden');
        clearBtn.classList.add('visible');
        canvas.classList.add('has-signature');
        checkForm();
      }
    }

    function stopDraw() {
      if (!drawing) return;
      drawing = false;
      canvas.classList.remove('active');
      if (hasSig) signatureImage = canvas.toDataURL('image/png');
    }

    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDraw);
    canvas.addEventListener('mouseleave', stopDraw);
    canvas.addEventListener('touchstart', startDraw, { passive: false });
    canvas.addEventListener('touchmove', draw, { passive: false });
    canvas.addEventListener('touchend', stopDraw);

    function applyTypedSignature() {
      if (signatureLocked) return;
      const text = typedInput.value.trim();
      if (!text) {
        clearSignature();
        return;
      }
      const rect = canvas.getBoundingClientRect();
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      let fontSize = Math.min(64, Math.max(28, rect.width * 0.18));
      ctx.fillStyle = signatureColor;
      ctx.textBaseline = 'middle';
      ctx.textAlign = 'left';
      ctx.font = `${fontSize}px ${typedFont.value}`;
      while (ctx.measureText(text).width > rect.width - 30 && fontSize > 20) {
        fontSize -= 2;
        ctx.font = `${fontSize}px ${typedFont.value}`;
      }
      ctx.fillText(text, 18, rect.height / 2);
      hasSig = true;
      signatureImage = canvas.toDataURL('image/png');
      placeholder.classList.add('hidden');
      clearBtn.classList.add('visible');
      canvas.classList.add('has-signature');
      checkForm();
    }

    function triggerSignatureUpload() {
      if (signatureLocked) return;
      sigFileInput.click();
    }

    function drawImageToCanvas(dataUrl) {
      const img = new Image();
      img.onload = () => {
        const rect = canvas.getBoundingClientRect();
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const scale = Math.min(rect.width / img.width, rect.height / img.height);
        const w = img.width * scale;
        const h = img.height * scale;
        const x = (rect.width - w) / 2;
        const y = (rect.height - h) / 2;
        ctx.drawImage(img, x, y, w, h);
        hasSig = true;
        signatureImage = canvas.toDataURL('image/png');
        placeholder.classList.add('hidden');
        clearBtn.classList.add('visible');
        canvas.classList.add('has-signature');
        checkForm();
      };
      img.src = dataUrl;
    }

    sigFileInput.addEventListener('change', (e) => {
      if (signatureLocked) return;
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => drawImageToCanvas(reader.result);
      reader.readAsDataURL(file);
      e.target.value = '';
    });

    function clearSignature() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      hasSig = false;
      signatureImage = '';
      placeholder.classList.remove('hidden');
      clearBtn.classList.remove('visible');
      canvas.classList.remove('has-signature');
      checkForm();
    }

    function lockSignatureControls() {
      signatureLocked = true;
      canvas.classList.add('locked');
      signNowBtn.disabled = true;
      penSizeInput.disabled = true;
      typedInput.disabled = true;
      typedFont.disabled = true;
      faxStore.disabled = true;
      clearBtn.disabled = true;
      document.querySelectorAll('.sig-option, .sig-color, #penSize, #typedSignature, #typedFont').forEach(el => {
        if (el.tagName === 'BUTTON' || el.tagName === 'INPUT' || el.tagName === 'SELECT') {
          el.disabled = true;
        }
      });
    }

    penSizeInput.addEventListener('input', (e) => {
      ctx.lineWidth = parseFloat(e.target.value);
    });
    typedInput.addEventListener('input', () => {
      if (signatureMode === 'type') applyTypedSignature();
    });
    typedFont.addEventListener('change', () => {
      if (signatureMode === 'type') applyTypedSignature();
    });
    window.addEventListener('resize', () => {
      resizeCanvas(true);
      updateOrientationHint();
    });
    window.addEventListener('orientationchange', () => {
      setTimeout(() => {
        resizeCanvas(true);
        updateOrientationHint();
      }, 200);
    });

    resizeCanvas(true);
    updateOrientationHint();

    /* ═══════════════════════════════════════════════════════════
       FORM VALIDATION
       ═══════════════════════════════════════════════════════════ */
    const dateInput = document.getElementById('signDate');
    const today = new Date();
    dateInput.value = `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`;
    const nameInput = document.getElementById('printedName');
    const consentBox = document.getElementById('digiConsent');
    const submitBtn = document.getElementById('submitBtn');
    function checkForm() {
      const signatureRequired = signatureMode !== 'fax';
      const signatureOk = signatureRequired ? hasSig : true;
      const faxOk = signatureMode === 'fax' ? !!faxStore.value : true;
      submitBtn.disabled = !(nameInput.value.trim().length > 0 && dateInput.value && consentBox.checked && signatureOk && faxOk);
    }
    nameInput.addEventListener('input', checkForm);
    dateInput.addEventListener('change', checkForm);
    consentBox.addEventListener('change', checkForm);
    faxStore.addEventListener('change', checkForm);

    /* ═══════════════════════════════════════════════════════════
       PDF GENERATION
       ═══════════════════════════════════════════════════════════ */
    let generatedPDF = null, pdfFileName = '';

    function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'letter' });
      const pageW = doc.internal.pageSize.getWidth(); const margin = 20; const contentW = pageW - margin * 2; let y = 20;

      doc.setFillColor(13, 27, 42); doc.rect(0, 0, pageW, 30, 'F');
      doc.setFont('helvetica', 'bold'); doc.setFontSize(16); doc.setTextColor(255, 255, 255);
      doc.text('ADV Teammate Handbook', margin, 14);
      doc.setFontSize(10); doc.setFont('helvetica', 'normal'); doc.setTextColor(148, 163, 184);
      doc.text('Acknowledgement of Receipt  |  Revised February 2025', margin, 23);
      y = 40;

      doc.setFont('helvetica', 'bold'); doc.setFontSize(13); doc.setTextColor(13, 27, 42);
      doc.text('Acknowledgement of Receipt', margin, y); y += 3;
      doc.setDrawColor(74, 144, 196); doc.setLineWidth(0.8); doc.line(margin, y, margin + 60, y); y += 8;

      doc.setFont('helvetica', 'normal'); doc.setFontSize(9.5); doc.setTextColor(55, 65, 81);
      const paras = [
        'I have received a copy of the Company\'s Handbook and the applicable Supplement(s) for the locations in which I work. I agree to read it and to comply with the policies and procedures described in the Handbook and Supplement(s). If I have any questions regarding any of the Handbook\'s provisions, I will consult with my supervisor, manager or Human Resources. I understand that if I do not follow the policies and procedures contained herein that I may be subject to disciplinary action, up to and including termination of employment.',
        'I also understand that this Handbook is the most up-to-date version of the Company\'s policies and procedures and replaces any prior written and oral communications about the subjects contained in it.',
        'I acknowledge that my employment relationship with the Company is "at-will", meaning that, regardless of anything contained in this Handbook and regardless of any custom or practice, either I or the Company may terminate my employment at any time, for any reason or no reason, with or without cause, and with or without procedural requirements. I understand that no representatives of the Company, other than the CEO in a writing signed by him/her/them, may enter into any agreements, or make any representations, written or oral, to alter my at-will status or otherwise create any contractual obligation between me and the Company.',
        'I further acknowledge that this handbook and the policies contained herein are not intended to create (and shall not be construed as creating) a contract (express or implied) for employment between the Company and any Teammate and that said policies can be modified by the Company at any time, with or without notice to me, in its sole and absolute discretion.',
        'By signing below, I acknowledge that I have received and will abide by the Company\'s Handbook and all the policies within it, including those on harassment, discrimination, retaliation, and bringing complaints regarding the same.'
      ];
      paras.forEach(p => { const lines = doc.splitTextToSize(p, contentW); doc.text(lines, margin, y); y += lines.length * 4.2 + 4; });
      y += 4;

      doc.setFillColor(241, 245, 249); doc.roundedRect(margin, y, contentW, 14, 2, 2, 'F');
      doc.setFont('helvetica', 'italic'); doc.setFontSize(8); doc.setTextColor(100, 116, 139);
      const ct = 'The signee agreed that their digital signature is the legal equivalent of a handwritten signature and that they intend to be bound by this acknowledgement.';
      doc.text(doc.splitTextToSize(ct, contentW - 8), margin + 4, y + 5); y += 20;

      doc.setFont('helvetica', 'bold'); doc.setFontSize(11); doc.setTextColor(13, 27, 42);
      doc.text('Teammate Signature', margin, y); y += 8;

      doc.setFont('helvetica', 'normal'); doc.setFontSize(8); doc.setTextColor(107, 114, 128);
      doc.text('PRINTED TEAMMATE NAME', margin, y); y += 5;
      doc.setFont('helvetica', 'bold'); doc.setFontSize(12); doc.setTextColor(31, 41, 55);
      doc.text(nameInput.value.trim(), margin, y); y += 3;
      doc.setDrawColor(209, 213, 219); doc.setLineWidth(0.4); doc.line(margin, y, margin + 80, y); y += 10;

      doc.setFont('helvetica', 'normal'); doc.setFontSize(8); doc.setTextColor(107, 114, 128);
      doc.text('TEAMMATE SIGNATURE', margin, y); y += 3;
      if (signatureMode === 'fax') {
        doc.setFont('helvetica', 'italic'); doc.setFontSize(9); doc.setTextColor(100, 116, 139);
        doc.text(`Signature pending via fax to store ${faxStore.value || 'N/A'}`, margin, y + 10);
        y += 27;
      } else if (signatureImage) {
        doc.addImage(signatureImage, 'PNG', margin, y, 70, 25);
        y += 27;
      } else {
        y += 27;
      }
      doc.line(margin, y, margin + 80, y); y += 10;

      doc.setFontSize(8); doc.setTextColor(107, 114, 128); doc.text('DATE', margin, y); y += 5;
      doc.setFont('helvetica', 'normal'); doc.setFontSize(11); doc.setTextColor(31, 41, 55);
      doc.text(new Date(dateInput.value + 'T12:00:00').toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }), margin, y);
      y += 3; doc.line(margin, y, margin + 50, y);

      const footerY = doc.internal.pageSize.getHeight() - 12;
      doc.setDrawColor(209, 213, 219); doc.setLineWidth(0.3); doc.line(margin, footerY - 4, pageW - margin, footerY - 4);
      doc.setFont('helvetica', 'normal'); doc.setFontSize(7); doc.setTextColor(156, 163, 175);
      doc.text('\u00A9 2025 Advantage Solutions Inc.  |  Confidential', margin, footerY);
      doc.text('Page 55 of 56', pageW - margin, footerY, { align: 'right' });

      const safeName = nameInput.value.trim().replace(/[^a-zA-Z0-9]/g, '_');
      pdfFileName = `Handbook_Ack_${safeName}_${dateInput.value.replace(/-/g, '')}.pdf`;
      generatedPDF = doc;
    }

    /* ═══════════════════════════════════════════════════════════
       SUBMIT
       ═══════════════════════════════════════════════════════════ */
    function handleSubmit() {
      let err = false;
      if (!nameInput.value.trim()) { document.getElementById('nameRow').classList.add('error'); err = true; } else { document.getElementById('nameRow').classList.remove('error'); }
      const sigError = document.getElementById('sigError');
      if (signatureMode === 'fax') {
        if (!faxStore.value) {
          sigError.textContent = 'Please select a store for fax delivery.';
          document.getElementById('sigRow').classList.add('error');
          err = true;
        } else {
          document.getElementById('sigRow').classList.remove('error');
        }
      } else if (!hasSig) {
        sigError.textContent = 'Please provide your signature above.';
        document.getElementById('sigRow').classList.add('error');
        err = true;
      } else {
        document.getElementById('sigRow').classList.remove('error');
      }
      if (!dateInput.value) { document.getElementById('dateRow').classList.add('error'); err = true; } else { document.getElementById('dateRow').classList.remove('error'); }
      if (err) return;

      generatePDF();
      lockSignatureControls();
      const fd = new Date(dateInput.value + 'T12:00:00').toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
      const delivery = signatureMode === 'fax' ? `Fax to store ${faxStore.value}` : 'Digital signature';
      document.getElementById('signerDetail').innerHTML = `<span><strong>Name:</strong> ${nameInput.value.trim()}</span><span><strong>Date:</strong> ${fd}</span><span><strong>Delivery:</strong> ${delivery}</span><span><strong>File:</strong> ${pdfFileName}</span>`;

      const odBtn = document.getElementById('onedriveSaveBtn');
      const odSt = document.getElementById('onedriveStatus');
      if (!ONEDRIVE_CLIENT_ID || typeof OneDrive === 'undefined') {
        odBtn.style.opacity = '0.5'; odBtn.style.cursor = 'not-allowed';
        odSt.textContent = 'OneDrive integration pending — app registration required';
      } else { odBtn.style.opacity = '1'; odBtn.style.cursor = 'pointer'; odSt.textContent = ''; }

      document.getElementById('saveOverlay').classList.add('show');
    }

    /* ═══════════════════════════════════════════════════════════
       ONEDRIVE SAVE
       ═══════════════════════════════════════════════════════════ */
    function saveToOneDrive() {
      if (!ONEDRIVE_CLIENT_ID) { alert('OneDrive integration is not configured yet.\n\nAn Azure AD App Registration (Client ID) is required.\nUse "Download PDF" for now.'); return; }
      if (typeof OneDrive === 'undefined') { alert('OneDrive SDK not loaded.\n\nEnsure the OneDrive.js script tag is uncommented in the HTML head.'); return; }
      const pdfBlob = generatedPDF.output('blob');
      const file = new File([pdfBlob], pdfFileName, { type: 'application/pdf' });
      const dt = new DataTransfer(); dt.items.add(file);
      document.getElementById('hiddenFileInput').files = dt.files;
      OneDrive.save({
        clientId: ONEDRIVE_CLIENT_ID, action: 'save',
        sourceInputElementId: 'hiddenFileInput', fileName: pdfFileName,
        openInNewWindow: true,
        advanced: { redirectUri: window.location.href },
        success: function() { document.getElementById('onedriveStatus').textContent = '✅ Saved to OneDrive successfully.'; document.getElementById('onedriveStatus').style.color = '#22c55e'; },
        cancel: function() { document.getElementById('onedriveStatus').textContent = 'Save cancelled.'; },
        error: function(e) { console.error('OneDrive error:', e); document.getElementById('onedriveStatus').textContent = 'Error saving — try downloading instead.'; document.getElementById('onedriveStatus').style.color = '#ef4444'; }
      });
    }

    function downloadPDF() { if (generatedPDF) generatedPDF.save(pdfFileName); }
    function closeSaveOverlay() { document.getElementById('saveOverlay').classList.remove('show'); }
    setSignatureMode('draw');
    checkForm();
  </script>
</body>
</html>
