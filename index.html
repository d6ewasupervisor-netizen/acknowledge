<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <title>ADV Teammate Handbook — The Retail Odyssey Company</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=DM+Serif+Display&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <style>
    :root {
      --navy-950: #060e1a;
      --navy-900: #0d1b2a;
      --navy-800: #1b2d4a;
      --navy-700: #243b5e;
      --navy-600: #2e4a72;
      --blue-500: #4a90c4;
      --blue-400: #6aaddb;
      --blue-300: #7cb9d8;
      --blue-200: #a3d5e8;
      --blue-100: #d4ecf5;
      --blue-50: #eef7fb;
      --slate-900: #0f172a;
      --slate-800: #1e293b;
      --slate-700: #334155;
      --slate-600: #475569;
      --slate-500: #64748b;
      --slate-400: #94a3b8;
      --slate-300: #cbd5e1;
      --slate-200: #e2e8f0;
      --slate-100: #f1f5f9;
      --slate-50: #f8fafc;
      --white: #ffffff;
      --red-500: #ef4444;
      --green-500: #22c55e;
      --amber-500: #f59e0b;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; -webkit-text-size-adjust: 100%; }
    body {
      font-family: 'Plus Jakarta Sans', -apple-system, sans-serif;
      background: var(--navy-950);
      color: var(--slate-800);
      line-height: 1.6;
      min-height: 100vh;
      overflow: hidden;
    }

    /* ═══════════════════════════════════════════════════
       LOADING SCREEN
       ═══════════════════════════════════════════════════ */
    #loadingScreen {
      position: fixed; inset: 0; z-index: 9999;
      background: var(--navy-900);
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      transition: opacity 0.6s ease, visibility 0.6s ease;
    }
    #loadingScreen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
    .loading-logo { height: 56px; margin-bottom: 2rem; animation: loadPulse 2s ease-in-out infinite; }
    .loading-bar-track { width: 200px; height: 3px; background: rgba(74,144,196,0.15); border-radius: 3px; overflow: hidden; }
    .loading-bar-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--blue-500), var(--blue-300)); border-radius: 3px; transition: width 0.3s ease; }
    .loading-text { color: var(--slate-400); font-size: 0.8rem; margin-top: 1rem; letter-spacing: 0.05em; }
    @keyframes loadPulse { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }

    /* ═══════════════════════════════════════════════════
       TOC / LANDING VIEW
       ═══════════════════════════════════════════════════ */
    #tocView {
      position: fixed; inset: 0; z-index: 50;
      background: var(--navy-900);
      overflow-y: auto; overflow-x: hidden;
      transition: opacity 0.4s ease, transform 0.4s ease;
    }
    #tocView.hidden {
      opacity: 0; transform: translateY(20px);
      pointer-events: none; visibility: hidden;
    }

    .toc-header {
      position: relative;
      padding: 3rem 2rem 2.5rem;
      text-align: center;
      background: linear-gradient(180deg, var(--navy-950) 0%, var(--navy-900) 100%);
      overflow: hidden;
    }
    .toc-header::before {
      content: '';
      position: absolute; top: -80px; right: -60px;
      width: 300px; height: 300px;
      background: radial-gradient(circle, rgba(74,144,196,0.08) 0%, transparent 70%);
      border-radius: 50%;
    }
    .toc-header::after {
      content: '';
      position: absolute; bottom: -100px; left: -40px;
      width: 250px; height: 250px;
      background: radial-gradient(circle, rgba(106,173,219,0.06) 0%, transparent 70%);
      border-radius: 50%;
    }
    .toc-logo { height: 52px; margin-bottom: 1.5rem; position: relative; z-index: 1; }
    .toc-title {
      font-family: 'DM Serif Display', serif;
      font-size: clamp(1.6rem, 4vw, 2.2rem);
      color: var(--white);
      margin-bottom: 0.4rem;
      position: relative; z-index: 1;
    }
    .toc-subtitle {
      color: var(--slate-400);
      font-size: 0.85rem;
      font-weight: 400;
      position: relative; z-index: 1;
    }
    .toc-actions {
      display: flex; gap: 0.75rem;
      justify-content: center;
      margin-top: 1.5rem;
      position: relative; z-index: 1;
      flex-wrap: wrap;
    }
    .toc-action-btn {
      display: inline-flex; align-items: center; gap: 0.5rem;
      padding: 0.65rem 1.4rem;
      border-radius: 8px;
      font-family: inherit; font-size: 0.85rem; font-weight: 600;
      cursor: pointer; border: none;
      transition: all 0.2s ease;
      text-decoration: none;
    }
    .toc-action-btn.primary {
      background: var(--blue-500);
      color: var(--white);
    }
    .toc-action-btn.primary:hover { background: var(--blue-400); transform: translateY(-1px); }
    .toc-action-btn.secondary {
      background: rgba(74,144,196,0.12);
      color: var(--blue-300);
      border: 1px solid rgba(74,144,196,0.25);
    }
    .toc-action-btn.secondary:hover { background: rgba(74,144,196,0.2); }
    .toc-action-btn svg { width: 16px; height: 16px; }

    .toc-body { max-width: 720px; margin: 0 auto; padding: 1.5rem 1.5rem 4rem; }

    .toc-search-bar {
      position: relative; margin-bottom: 1.5rem;
    }
    .toc-search-bar input {
      width: 100%; padding: 0.75rem 1rem 0.75rem 2.75rem;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(74,144,196,0.2);
      border-radius: 10px;
      font-family: inherit; font-size: 0.9rem;
      color: var(--white);
      outline: none;
      transition: border-color 0.2s, background 0.2s;
    }
    .toc-search-bar input::placeholder { color: var(--slate-500); }
    .toc-search-bar input:focus {
      border-color: var(--blue-500);
      background: rgba(255,255,255,0.08);
    }
    .toc-search-bar .search-icon {
      position: absolute; left: 0.85rem; top: 50%; transform: translateY(-50%);
      width: 18px; height: 18px; color: var(--slate-500);
      pointer-events: none;
    }

    .toc-group { margin-bottom: 0.5rem; }
    .toc-group-header {
      display: flex; align-items: center; gap: 0.75rem;
      padding: 0.85rem 1rem;
      background: rgba(74,144,196,0.08);
      border: 1px solid rgba(74,144,196,0.12);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 2px;
    }
    .toc-group-header:hover { background: rgba(74,144,196,0.14); }
    .toc-group-header .section-number {
      width: 28px; height: 28px;
      background: var(--blue-500);
      border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
      font-size: 0.7rem; font-weight: 700; color: var(--white);
      flex-shrink: 0;
    }
    .toc-group-header .section-title {
      flex: 1;
      font-size: 0.9rem; font-weight: 700;
      color: var(--white);
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .toc-group-header .section-page {
      font-size: 0.75rem; color: var(--slate-400);
      font-weight: 500;
    }
    .toc-group-header .chevron {
      width: 16px; height: 16px; color: var(--slate-500);
      transition: transform 0.25s ease;
      flex-shrink: 0;
    }
    .toc-group.open .toc-group-header .chevron { transform: rotate(90deg); }

    .toc-subitems {
      max-height: 0; overflow: hidden;
      transition: max-height 0.35s ease;
      padding-left: 0.5rem;
    }
    .toc-group.open .toc-subitems { max-height: 2000px; }

    .toc-subitem {
      display: flex; align-items: center; gap: 0.75rem;
      padding: 0.55rem 1rem 0.55rem 3.25rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.15s ease;
    }
    .toc-subitem:hover { background: rgba(74,144,196,0.08); }
    .toc-subitem .sub-title {
      flex: 1;
      font-size: 0.84rem; color: var(--slate-300);
      font-weight: 400;
    }
    .toc-subitem .sub-page {
      font-size: 0.72rem; color: var(--slate-500);
      font-weight: 500;
      min-width: 24px; text-align: right;
    }

    /* ═══════════════════════════════════════════════════
       PDF READER VIEW
       ═══════════════════════════════════════════════════ */
    #readerView {
      position: fixed; inset: 0; z-index: 40;
      background: var(--navy-950);
      display: flex; flex-direction: column;
      transition: opacity 0.3s ease;
    }
    #readerView.hidden { opacity: 0; pointer-events: none; visibility: hidden; }

    /* Top Toolbar */
    .reader-toolbar {
      display: flex; align-items: center; gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: var(--navy-900);
      border-bottom: 1px solid rgba(74,144,196,0.12);
      flex-shrink: 0;
      z-index: 10;
    }
    .toolbar-logo { height: 28px; margin-right: 0.25rem; cursor: pointer; }
    .toolbar-divider { width: 1px; height: 24px; background: rgba(74,144,196,0.15); margin: 0 0.25rem; }
    .toolbar-page-info {
      font-size: 0.78rem; color: var(--slate-400);
      font-weight: 500; white-space: nowrap;
      min-width: 80px; text-align: center;
    }
    .toolbar-page-info strong { color: var(--white); font-weight: 600; }
    .toolbar-spacer { flex: 1; }
    .toolbar-btn {
      display: flex; align-items: center; justify-content: center; gap: 0.35rem;
      padding: 0.4rem 0.6rem;
      background: transparent;
      border: 1px solid transparent;
      border-radius: 6px;
      color: var(--slate-400);
      font-family: inherit; font-size: 0.75rem; font-weight: 600;
      cursor: pointer;
      transition: all 0.15s ease;
      white-space: nowrap;
    }
    .toolbar-btn:hover { background: rgba(74,144,196,0.1); color: var(--blue-300); }
    .toolbar-btn.active { background: rgba(74,144,196,0.15); color: var(--blue-400); border-color: rgba(74,144,196,0.25); }
    .toolbar-btn svg { width: 16px; height: 16px; flex-shrink: 0; }
    .toolbar-btn .btn-label { display: inline; }
    @media (max-width: 640px) { .toolbar-btn .btn-label { display: none; } }

    .toolbar-btn.ack-btn {
      background: var(--blue-500);
      color: var(--white);
      border-color: var(--blue-500);
      text-decoration: none;
    }
    .toolbar-btn.ack-btn:hover { background: var(--blue-400); border-color: var(--blue-400); }

    /* Zoom controls */
    .zoom-controls {
      display: flex; align-items: center; gap: 2px;
      background: rgba(255,255,255,0.04);
      border-radius: 6px;
      padding: 2px;
    }
    .zoom-btn {
      display: flex; align-items: center; justify-content: center;
      width: 30px; height: 30px;
      background: transparent; border: none; border-radius: 4px;
      color: var(--slate-400); cursor: pointer;
      transition: all 0.15s ease;
    }
    .zoom-btn:hover { background: rgba(74,144,196,0.15); color: var(--blue-300); }
    .zoom-btn svg { width: 15px; height: 15px; }
    .zoom-level {
      font-size: 0.72rem; color: var(--slate-400); font-weight: 600;
      min-width: 38px; text-align: center;
      user-select: none;
    }

    /* Page Canvas Area */
    .reader-canvas-area {
      flex: 1; overflow: auto;
      display: flex; align-items: flex-start; justify-content: center;
      padding: 1rem;
      position: relative;
      touch-action: pan-y pinch-zoom;
    }
    .reader-canvas-area.swiping { touch-action: none; }

    #pdfCanvas {
      background: var(--white);
      box-shadow: 0 4px 32px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.05);
      border-radius: 4px;
      max-width: 100%;
      transition: transform 0.15s ease;
    }

    /* Bottom Nav */
    .reader-bottom {
      display: flex; align-items: center; gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--navy-900);
      border-top: 1px solid rgba(74,144,196,0.12);
      flex-shrink: 0;
      z-index: 10;
    }
    .nav-btn {
      display: flex; align-items: center; justify-content: center;
      width: 40px; height: 40px;
      background: rgba(74,144,196,0.08);
      border: 1px solid rgba(74,144,196,0.15);
      border-radius: 8px;
      color: var(--slate-400);
      cursor: pointer;
      transition: all 0.15s ease;
      flex-shrink: 0;
    }
    .nav-btn:hover { background: rgba(74,144,196,0.18); color: var(--blue-300); }
    .nav-btn:disabled { opacity: 0.3; cursor: not-allowed; }
    .nav-btn svg { width: 18px; height: 18px; }

    .page-slider-container { flex: 1; display: flex; align-items: center; padding: 0 0.5rem; }
    .page-slider {
      width: 100%; height: 4px;
      -webkit-appearance: none; appearance: none;
      background: rgba(74,144,196,0.15);
      border-radius: 4px; outline: none;
      cursor: pointer;
    }
    .page-slider::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none;
      width: 16px; height: 16px;
      background: var(--blue-500);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 8px rgba(74,144,196,0.4);
    }
    .page-slider::-moz-range-thumb {
      width: 16px; height: 16px;
      background: var(--blue-500);
      border-radius: 50%; border: none;
      cursor: pointer;
    }

    /* ═══════════════════════════════════════════════════
       TOC OVERLAY (in reader)
       ═══════════════════════════════════════════════════ */
    .overlay-backdrop {
      position: fixed; inset: 0; z-index: 60;
      background: rgba(6,14,26,0.7);
      backdrop-filter: blur(4px);
      opacity: 0; visibility: hidden;
      transition: all 0.3s ease;
    }
    .overlay-backdrop.show { opacity: 1; visibility: visible; }

    .toc-overlay {
      position: fixed; top: 0; left: 0; bottom: 0;
      width: min(380px, 85vw); z-index: 61;
      background: var(--navy-900);
      border-right: 1px solid rgba(74,144,196,0.15);
      transform: translateX(-100%);
      transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      overflow-y: auto;
      display: flex; flex-direction: column;
    }
    .toc-overlay.show { transform: translateX(0); }

    .toc-overlay-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 1rem 1.25rem;
      border-bottom: 1px solid rgba(74,144,196,0.12);
      flex-shrink: 0;
    }
    .toc-overlay-header h3 {
      font-family: 'DM Serif Display', serif;
      font-size: 1.1rem; color: var(--white);
    }
    .toc-overlay-close {
      width: 32px; height: 32px;
      display: flex; align-items: center; justify-content: center;
      background: rgba(255,255,255,0.06);
      border: none; border-radius: 6px;
      color: var(--slate-400); cursor: pointer;
      transition: all 0.15s;
    }
    .toc-overlay-close:hover { background: rgba(255,255,255,0.1); color: var(--white); }
    .toc-overlay-close svg { width: 16px; height: 16px; }

    .toc-overlay-body { flex: 1; overflow-y: auto; padding: 0.75rem; }

    .toc-ol-group { margin-bottom: 0.25rem; }
    .toc-ol-section {
      display: flex; align-items: center; gap: 0.5rem;
      padding: 0.6rem 0.75rem;
      border-radius: 8px; cursor: pointer;
      transition: background 0.15s;
    }
    .toc-ol-section:hover { background: rgba(74,144,196,0.1); }
    .toc-ol-section.current { background: rgba(74,144,196,0.15); }
    .toc-ol-section .ol-dot {
      width: 6px; height: 6px;
      background: var(--blue-500);
      border-radius: 50%; flex-shrink: 0;
    }
    .toc-ol-section.current .ol-dot { box-shadow: 0 0 6px var(--blue-400); }
    .toc-ol-section .ol-title {
      flex: 1; font-size: 0.82rem; font-weight: 600;
      color: var(--white);
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }
    .toc-ol-section .ol-page {
      font-size: 0.7rem; color: var(--slate-500);
      font-weight: 500;
    }

    .toc-ol-sub {
      display: flex; align-items: center; gap: 0.5rem;
      padding: 0.4rem 0.75rem 0.4rem 2rem;
      border-radius: 6px; cursor: pointer;
      transition: background 0.15s;
    }
    .toc-ol-sub:hover { background: rgba(74,144,196,0.08); }
    .toc-ol-sub.current { background: rgba(74,144,196,0.1); }
    .toc-ol-sub .ol-title {
      flex: 1; font-size: 0.78rem; color: var(--slate-300);
      font-weight: 400;
    }
    .toc-ol-sub .ol-page {
      font-size: 0.68rem; color: var(--slate-500);
      font-weight: 500;
    }

    /* ═══════════════════════════════════════════════════
       SEARCH OVERLAY
       ═══════════════════════════════════════════════════ */
    .search-overlay {
      position: fixed; top: 0; right: 0; bottom: 0;
      width: min(420px, 90vw); z-index: 61;
      background: var(--navy-900);
      border-left: 1px solid rgba(74,144,196,0.15);
      transform: translateX(100%);
      transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex; flex-direction: column;
    }
    .search-overlay.show { transform: translateX(0); }

    .search-overlay-header {
      padding: 1rem 1.25rem;
      border-bottom: 1px solid rgba(74,144,196,0.12);
      flex-shrink: 0;
    }
    .search-overlay-header .search-row {
      display: flex; align-items: center; gap: 0.5rem;
    }
    .search-overlay-header input {
      flex: 1; padding: 0.65rem 0.9rem;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(74,144,196,0.2);
      border-radius: 8px;
      font-family: inherit; font-size: 0.88rem;
      color: var(--white); outline: none;
      transition: border-color 0.2s;
    }
    .search-overlay-header input:focus { border-color: var(--blue-500); }
    .search-overlay-header input::placeholder { color: var(--slate-500); }
    .search-count { font-size: 0.75rem; color: var(--slate-500); margin-top: 0.5rem; }

    .search-results { flex: 1; overflow-y: auto; padding: 0.5rem; }
    .search-result-item {
      padding: 0.75rem; border-radius: 8px;
      cursor: pointer; transition: background 0.15s;
      margin-bottom: 2px;
    }
    .search-result-item:hover { background: rgba(74,144,196,0.08); }
    .search-result-item .result-page {
      font-size: 0.72rem; color: var(--blue-400);
      font-weight: 600; margin-bottom: 0.25rem;
    }
    .search-result-item .result-context {
      font-size: 0.8rem; color: var(--slate-300);
      line-height: 1.5;
    }
    .search-result-item .result-context mark {
      background: rgba(74,144,196,0.3);
      color: var(--blue-200);
      border-radius: 2px; padding: 0 2px;
    }

    /* ═══════════════════════════════════════════════════
       SECTION TOOLS POPOVER
       ═══════════════════════════════════════════════════ */
    .section-tools-pop {
      position: fixed; z-index: 55;
      background: var(--navy-800);
      border: 1px solid rgba(74,144,196,0.2);
      border-radius: 10px;
      padding: 0.5rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      opacity: 0; visibility: hidden;
      transform: translateY(4px);
      transition: all 0.2s ease;
    }
    .section-tools-pop.show { opacity: 1; visibility: visible; transform: translateY(0); }
    .section-tool-btn {
      display: flex; align-items: center; gap: 0.6rem;
      width: 100%; padding: 0.55rem 0.85rem;
      background: transparent; border: none; border-radius: 6px;
      color: var(--slate-300); font-family: inherit;
      font-size: 0.8rem; cursor: pointer;
      transition: background 0.15s;
      white-space: nowrap;
    }
    .section-tool-btn:hover { background: rgba(74,144,196,0.12); color: var(--white); }
    .section-tool-btn svg { width: 15px; height: 15px; flex-shrink: 0; color: var(--blue-400); }

    /* ═══════════════════════════════════════════════════
       TOAST NOTIFICATION
       ═══════════════════════════════════════════════════ */
    .toast {
      position: fixed; bottom: 5rem; left: 50%; transform: translateX(-50%) translateY(20px);
      background: var(--navy-800);
      border: 1px solid rgba(74,144,196,0.2);
      color: var(--white);
      pad
    .toolbar-btn svg { width: 16px; height: 16px; flex-shrink: 0; }
    .toolbar-btn .btn-label { display: inline; }
    @media (max-width: 640px) { .toolbar-btn .btn-label { display: none; } }

    .toolbar-btn.ack-btn {
      background: var(--blue-500);
      color: var(--white);
      border-color: var(--blue-500);
      text-decoration: none;
    }
    .toolbar-btn.ack-btn:hover { background: var(--blue-400); border-color: var(--blue-400); }

    /* Zoom controls */
    .zoom-controls {
      display: flex; align-items: center; gap: 2px;
      background: rgba(255,255,255,0.04);
      border-radius: 6px;
      padding: 2px;
    }
    .zoom-btn {
      display: flex; align-items: center; justify-content: center;
      width: 30px; height: 30px;
      background: transparent; border: none; border-radius: 4px;
      color: var(--slate-400); cursor: pointer;
      transition: all 0.15s ease;
    }
    .zoom-btn:hover { background: rgba(74,144,196,0.15); color: var(--blue-300); }
    .zoom-btn svg { width: 15px; height: 15px; }
    .zoom-level {
      font-size: 0.72rem; color: var(--slate-400); font-weight: 600;
      min-width: 38px; text-align: center;
      user-select: none;
    }

    /* Page Canvas Area */
    .reader-canvas-area {
      flex: 1; overflow: auto;
      display: flex; align-items: flex-start; justify-content: center;
      padding: 1rem;
      position: relative;
      touch-action: pan-y pinch-zoom;
    }
    .reader-canvas-area.swiping { touch-action: none; }

    #pdfCanvas {
      background: var(--white);
      box-shadow: 0 4px 32px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.05);
      border-radius: 4px;
      max-width: 100%;
      transition: transform 0.15s ease;
    }

    /* Bottom Nav */
    .reader-bottom {
      display: flex; align-items: center; gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--navy-900);
      border-top: 1px solid rgba(74,144,196,0.12);
      flex-shrink: 0;
      z-index: 10;
    }
    .nav-btn {
      display: flex; align-items: center; justify-content: center;
      width: 40px; height: 40px;
      background: rgba(74,144,196,0.08);
      border: 1px solid rgba(74,144,196,0.15);
      border-radius: 8px;
      color: var(--slate-400);
      cursor: pointer;
      transition: all 0.15s ease;
      flex-shrink: 0;
    }
    .nav-btn:hover { background: rgba(74,144,196,0.18); color: var(--blue-300); }
    .nav-btn:disabled { opacity: 0.3; cursor: not-allowed; }
    .nav-btn svg { width: 18px; height: 18px; }

    .page-slider-container { flex: 1; display: flex; align-items: center; padding: 0 0.5rem; }
    .page-slider {
      width: 100%; height: 4px;
      -webkit-appearance: none; appearance: none;
      background: rgba(74,144,196,0.15);
      border-radius: 4px; outline: none;
      cursor: pointer;
    }
    .page-slider::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none;
      width: 16px; height: 16px;
      background: var(--blue-500);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 8px rgba(74,144,196,0.4);
    }
    .page-slider::-moz-range-thumb {
      width: 16px; height: 16px;
      background: var(--blue-500);
      border-radius: 50%; border: none;
      cursor: pointer;
    }

    /* ═══════════════════════════════════════════════════
       TOC OVERLAY (in reader)
       ═══════════════════════════════════════════════════ */
    .overlay-backdrop {
      position: fixed; inset: 0; z-index: 60;
      background: rgba(6,14,26,0.7);
      backdrop-filter: blur(4px);
      opacity: 0; visibility: hidden;
      transition: all 0.3s ease;
    }
    .overlay-backdrop.show { opacity: 1; visibility: visible; }

    .toc-overlay {
      position: fixed; top: 0; left: 0; bottom: 0;
      width: min(380px, 85vw); z-index: 61;
      background: var(--navy-900);
      border-right: 1px solid rgba(74,144,196,0.15);
      transform: translateX(-100%);
      transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      overflow-y: auto;
      display: flex; flex-direction: column;
    }
    .toc-overlay.show { transform: translateX(0); }

    .toc-overlay-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 1rem 1.25rem;
      border-bottom: 1px solid rgba(74,144,196,0.12);
      flex-shrink: 0;
    }
    .toc-overlay-header h3 {
      font-family: 'DM Serif Display', serif;
      font-size: 1.1rem; color: var(--white);
    }
    .toc-overlay-close {
      width: 32px; height: 32px;
      display: flex; align-items: center; justify-content: center;
      background: rgba(255,255,255,0.06);
      border: none; border-radius: 6px;
      color: var(--slate-400); cursor: pointer;
      transition: all 0.15s;
    }
    .toc-overlay-close:hover { background: rgba(255,255,255,0.1); color: var(--white); }
    .toc-overlay-close svg { width: 16px; height: 16px; }

    .toc-overlay-body { flex: 1; overflow-y: auto; padding: 0.75rem; }

    .toc-ol-group { margin-bottom: 0.25rem; }
    .toc-ol-section {
      display: flex; align-items: center; gap: 0.5rem;
      padding: 0.6rem 0.75rem;
      border-radius: 8px; cursor: pointer;
      transition: background 0.15s;
    }
    .toc-ol-section:hover { background: rgba(74,144,196,0.1); }
    .toc-ol-section.current { background: rgba(74,144,196,0.15); }
    .toc-ol-section .ol-dot {
      width: 6px; height: 6px;
      background: var(--blue-500);
      border-radius: 50%; flex-shrink: 0;
    }
    .toc-ol-section.current .ol-dot { box-shadow: 0 0 6px var(--blue-400); }
    .toc-ol-section .ol-title {
      flex: 1; font-size: 0.82rem; font-weight: 600;
      color: var(--white);
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }
    .toc-ol-section .ol-page {
      font-size: 0.7rem; color: var(--slate-500);
      font-weight: 500;
    }

    .toc-ol-sub {
      display: flex; align-items: center; gap: 0.5rem;
      padding: 0.4rem 0.75rem 0.4rem 2rem;
      border-radius: 6px; cursor: pointer;
      transition: background 0.15s;
    }
    .toc-ol-sub:hover { background: rgba(74,144,196,0.08); }
    .toc-ol-sub.current { background: rgba(74,144,196,0.1); }
    .toc-ol-sub .ol-title {
      flex: 1; font-size: 0.78rem; color: var(--slate-300);
      font-weight: 400;
    }
    .toc-ol-sub .ol-page {
      font-size: 0.68rem; color: var(--slate-500);
      font-weight: 500;
    }

    /* ═══════════════════════════════════════════════════
       SEARCH OVERLAY
       ═══════════════════════════════════════════════════ */
    .search-overlay {
      position: fixed; top: 0; right: 0; bottom: 0;
      width: min(420px, 90vw); z-index: 61;
      background: var(--navy-900);
      border-left: 1px solid rgba(74,144,196,0.15);
      transform: translateX(100%);
      transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex; flex-direction: column;
    }
    .search-overlay.show { transform: translateX(0); }

    .search-overlay-header {
      padding: 1rem 1.25rem;
      border-bottom: 1px solid rgba(74,144,196,0.12);
      flex-shrink: 0;
    }
    .search-overlay-header .search-row {
      display: flex; align-items: center; gap: 0.5rem;
    }
    .search-overlay-header input {
      flex: 1; padding: 0.65rem 0.9rem;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(74,144,196,0.2);
      border-radius: 8px;
      font-family: inherit; font-size: 0.88rem;
      color: var(--white); outline: none;
      transition: border-color 0.2s;
    }
    .search-overlay-header input:focus { border-color: var(--blue-500); }
    .search-overlay-header input::placeholder { color: var(--slate-500); }
    .search-count { font-size: 0.75rem; color: var(--slate-500); margin-top: 0.5rem; }

    .search-results { flex: 1; overflow-y: auto; padding: 0.5rem; }
    .search-result-item {
      padding: 0.75rem; border-radius: 8px;
      cursor: pointer; transition: background 0.15s;
      margin-bottom: 2px;
    }
    .search-result-item:hover { background: rgba(74,144,196,0.08); }
    .search-result-item .result-page {
      font-size: 0.72rem; color: var(--blue-400);
      font-weight: 600; margin-bottom: 0.25rem;
    }
    .search-result-item .result-context {
      font-size: 0.8rem; color: var(--slate-300);
      line-height: 1.5;
    }
    .search-result-item .result-context mark {
      background: rgba(74,144,196,0.3);
      color: var(--blue-200);
      border-radius: 2px; padding: 0 2px;
    }

    /* ═══════════════════════════════════════════════════
       SECTION TOOLS POPOVER
       ═══════════════════════════════════════════════════ */
    .section-tools-pop {
      position: fixed; z-index: 55;
      background: var(--navy-800);
      border: 1px solid rgba(74,144,196,0.2);
      border-radius: 10px;
      padding: 0.5rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      opacity: 0; visibility: hidden;
      transform: translateY(4px);
      transition: all 0.2s ease;
    }
    .section-tools-pop.show { opacity: 1; visibility: visible; transform: translateY(0); }
    .section-tool-btn {
      display: flex; align-items: center; gap: 0.6rem;
      width: 100%; padding: 0.55rem 0.85rem;
      background: transparent; border: none; border-radius: 6px;
      color: var(--slate-300); font-family: inherit;
      font-size: 0.8rem; cursor: pointer;
      transition: background 0.15s;
      white-space: nowrap;
    }
    .section-tool-btn:hover { background: rgba(74,144,196,0.12); color: var(--white); }
    .section-tool-btn svg { width: 15px; height: 15px; flex-shrink: 0; color: var(--blue-400); }

    /* ═══════════════════════════════════════════════════
       TOAST NOTIFICATION
       ═══════════════════════════════════════════════════ */
    .toast {
      position: fixed; bottom: 5rem; left: 50%; transform: translateX(-50%) translateY(20px);
      background: var(--navy-800);
      border: 1px solid rgba(74,144,196,0.2);
      color: var(--white);
      pad}

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    .footer { text-align: center; padding: 2rem 1rem; font-size: 0.78rem; color: var(--gray-400); }

    @media print {
      body { background: white; }
      .download-card, .submit-btn, .sig-clear, .consent-row { display: none !important; }
      .ack-section, .form-section { box-shadow: none; border: 1px solid #ccc; }
    }
  </style>
</head>
<body>

  <header class="header">
    <div class="header-inner">
      <img src="ro_logo.png" alt="The Retail Odyssey Company" class="header-logo">
      <h1>Teammate Handbook Acknowledgement</h1>
      <p>Revised February 2025 &nbsp;·&nbsp; Please review, sign, and submit</p>
    </div>
  </header>

  <main class="container">
    <div class="download-card">
      <div class="download-icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.8" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"/></svg>
      </div>
      <div class="download-info">
        <h3>ADV Teammate Handbook</h3>
        <p>PDF &nbsp;·&nbsp; 56 pages &nbsp;·&nbsp; Revised Feb 2025</p>
      </div>
      <a href="2025_Teammate_Handbook.pdf" target="_blank" class="download-btn" download>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"/></svg>
        Download
      </a>
    </div>

    <section class="ack-section">
      <h2>Acknowledgement of Receipt</h2>
      <div class="ack-text">
        <p>I have received a copy of the Company's Handbook and the applicable Supplement(s) for the locations in which I work. I agree to read it and to comply with the policies and procedures described in the Handbook and Supplement(s). If I have any questions regarding any of the Handbook's provisions, I will consult with my supervisor, manager or Human Resources. I understand that if I do not follow the policies and procedures contained herein that I may be subject to disciplinary action, up to and including termination of employment.</p>
        <p>I also understand that this Handbook is the most up-to-date version of the Company's policies and procedures and replaces any prior written and oral communications about the subjects contained in it.</p>
        <p>I acknowledge that my employment relationship with the Company is "at-will", meaning that, regardless of anything contained in this Handbook and regardless of any custom or practice, either I or the Company may terminate my employment at any time, for any reason or no reason, with or without cause, and with or without procedural requirements. I understand that no representatives of the Company, other than the CEO in a writing signed by him/her/them, may enter into any agreements, or make any representations, written or oral, to alter my at-will status or otherwise create any contractual obligation between me and the Company.</p>
        <p>I further acknowledge that this handbook and the policies contained herein are not intended to create (and shall not be construed as creating) a contract (express or implied) for employment between the Company and any Teammate and that said policies can be modified by the Company at any time, with or without notice to me, in its sole and absolute discretion.</p>
        <p>By signing below, I acknowledge that I have received and will abide by the Company's Handbook and all the policies within it, including those on harassment, discrimination, retaliation, and bringing complaints regarding the same.</p>
      </div>
    </section>

    <section class="form-section">
      <h2>Sign Below</h2>
      <div class="form-row" id="nameRow">
        <label for="printedName">Printed Teammate Name</label>
        <input type="text" id="printedName" placeholder="Enter your full legal name" autocomplete="name">
        <div class="error-msg">Please enter your full name.</div>
      </div>
      <div class="form-row" id="sigRow">
        <label>Teammate Signature</label>
        <div class="sig-container">
          <canvas id="sigCanvas" class="sig-canvas"></canvas>
          <div class="sig-line"></div>
          <span id="sigPlaceholder" class="sig-placeholder">Sign here using your mouse or finger</span>
          <button type="button" id="sigClear" class="sig-clear" onclick="clearSignature()">Clear</button>
        </div>
        <div class="error-msg">Please provide your signature above.</div>
      </div>
      <div class="form-grid">
        <div class="form-row" id="dateRow">
          <label for="signDate">Date</label>
          <input type="date" id="signDate">
          <div class="error-msg">Please select today's date.</div>
        </div>
      </div>
      <div class="consent-row">
        <input type="checkbox" id="digiConsent">
        <label for="digiConsent">By checking this box, I agree that my digital signature above is the legal equivalent of my handwritten signature and that I intend to be bound by this acknowledgement. I confirm I have <strong>reviewed the ADV Teammate Handbook</strong> and understand the policies and procedures described within it.</label>
      </div>
      <button type="button" class="submit-btn" id="submitBtn" disabled onclick="handleSubmit()">Submit Acknowledgement</button>
    </section>
  </main>

  <footer class="footer">&copy; 2025 Advantage Solutions Inc. &nbsp;·&nbsp; All rights reserved.</footer>

  <input type="file" id="hiddenFileInput" accept=".pdf">

  <div class="save-overlay" id="saveOverlay">
    <div class="save-card">
      <div class="save-icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"/></svg>
      </div>
      <h3>Acknowledgement Signed</h3>
      <p>Your signed acknowledgement PDF is ready. Choose how to save it.</p>
      <div class="signer-detail" id="signerDetail"></div>
      <div class="save-buttons">
        <button class="save-btn onedrive" id="onedriveSaveBtn" onclick="saveToOneDrive()">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12.39 4.19c1.66-.89 3.73-.78 5.28.32a5.17 5.17 0 0 1 2.2 3.54 4.38 4.38 0 0 1 2.67 1.81 4.34 4.34 0 0 1 .72 3.1 4.36 4.36 0 0 1-1.67 2.85 4.4 4.4 0 0 1-3.14.94H6.13a5.07 5.07 0 0 1-3.55-1.38A4.91 4.91 0 0 1 1.1 12a4.94 4.94 0 0 1 2.1-3.07 5.03 5.03 0 0 1 3.56-.85c.54-1.71 1.78-3.07 3.43-3.59a5.89 5.89 0 0 1 2.2-.3Z"/></svg>
          Save to OneDrive
        </button>
        <div class="onedrive-status" id="onedriveStatus"></div>
        <button class="save-btn download" id="downloadBtn" onclick="downloadPDF()">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"/></svg>
          Download PDF to Device
        </button>
        <button class="save-btn done" onclick="closeSaveOverlay()">Close</button>
      </div>
    </div>
  </div>

  <script>
    /* ═══════════════════════════════════════════════════════════
       CONFIG — Replace with your Azure AD App (Client) ID
       ═══════════════════════════════════════════════════════════ */
    const ONEDRIVE_CLIENT_ID = ''; // e.g. 'a1b2c3d4-e5f6-7890-abcd-ef1234567890'

    /* ═══════════════════════════════════════════════════════════
       SIGNATURE PAD
       ═══════════════════════════════════════════════════════════ */
    const canvas = document.getElementById('sigCanvas');
    const ctx = canvas.getContext('2d');
    const placeholder = document.getElementById('sigPlaceholder');
    const clearBtn = document.getElementById('sigClear');
    let drawing = false, hasSig = false;

    function resizeCanvas() {
      const rect = canvas.getBoundingClientRect();
      const dpr = window.devicePixelRatio || 1;
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      ctx.lineWidth = 2; ctx.lineCap = 'round'; ctx.lineJoin = 'round'; ctx.strokeStyle = '#1f2937';
    }
    resizeCanvas();
    window.addEventListener('resize', () => { resizeCanvas(); if (hasSig) { hasSig = false; placeholder.classList.remove('hidden'); clearBtn.classList.remove('visible'); canvas.classList.remove('has-signature'); checkForm(); }});

    function getPos(e) {
      const rect = canvas.getBoundingClientRect();
      const cx = e.touches ? e.touches[0].clientX : e.clientX;
      const cy = e.touches ? e.touches[0].clientY : e.clientY;
      return { x: cx - rect.left, y: cy - rect.top };
    }
    function startDraw(e) { e.preventDefault(); drawing = true; canvas.classList.add('active'); const p = getPos(e); ctx.beginPath(); ctx.moveTo(p.x, p.y); }
    function draw(e) {
      if (!drawing) return; e.preventDefault(); const p = getPos(e); ctx.lineTo(p.x, p.y); ctx.stroke();
      if (!hasSig) { hasSig = true; placeholder.classList.add('hidden'); clearBtn.classList.add('visible'); canvas.classList.add('has-signature'); checkForm(); }
    }
    function stopDraw() { drawing = false; canvas.classList.remove('active'); }
    canvas.addEventListener('mousedown', startDraw); canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDraw); canvas.addEventListener('mouseleave', stopDraw);
    canvas.addEventListener('touchstart', startDraw, { passive: false });
    canvas.addEventListener('touchmove', draw, { passive: false });
    canvas.addEventListener('touchend', stopDraw);

    function clearSignature() { ctx.clearRect(0, 0, canvas.width, canvas.height); hasSig = false; placeholder.classList.remove('hidden'); clearBtn.classList.remove('visible'); canvas.classList.remove('has-signature'); checkForm(); }

    /* ═══════════════════════════════════════════════════════════
       FORM VALIDATION
       ═══════════════════════════════════════════════════════════ */
    const dateInput = document.getElementById('signDate');
    const today = new Date();
    dateInput.value = `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`;
    const nameInput = document.getElementById('printedName');
    const consentBox = document.getElementById('digiConsent');
    const submitBtn = document.getElementById('submitBtn');
    function checkForm() { submitBtn.disabled = !(nameInput.value.trim().length > 0 && hasSig && dateInput.value && consentBox.checked); }
    nameInput.addEventListener('input', checkForm); dateInput.addEventListener('change', checkForm); consentBox.addEventListener('change', checkForm);

    /* ═══════════════════════════════════════════════════════════
       PDF GENERATION (jsPDF)
       ═══════════════════════════════════════════════════════════ */
    let generatedPDF = null, pdfFileName = '';

    function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'letter' });
      const pageW = doc.internal.pageSize.getWidth(); const margin = 20; const contentW = pageW - margin * 2; let y = 20;

      doc.setFillColor(13, 59, 59); doc.rect(0, 0, pageW, 30, 'F');
      doc.setFont('helvetica', 'bold'); doc.setFontSize(16); doc.setTextColor(255, 255, 255);
      doc.text('ADV Teammate Handbook', margin, 14);
      doc.setFontSize(10); doc.setFont('helvetica', 'normal'); doc.setTextColor(200, 220, 210);
      doc.text('Acknowledgement of Receipt  |  Revised February 2025', margin, 23);
      y = 40;

      doc.setFont('helvetica', 'bold'); doc.setFontSize(13); doc.setTextColor(13, 59, 59);
      doc.text('Acknowledgement of Receipt', margin, y); y += 3;
      doc.setDrawColor(209, 250, 229); doc.setLineWidth(0.8); doc.line(margin, y, margin + 60, y); y += 8;

      doc.setFont('helvetica', 'normal'); doc.setFontSize(9.5); doc.setTextColor(55, 65, 81);
      const paras = [
        'I have received a copy of the Company\'s Handbook and the applicable Supplement(s) for the locations in which I work. I agree to read it and to comply with the policies and procedures described in the Handbook and Supplement(s). If I have any questions regarding any of the Handbook\'s provisions, I will consult with my supervisor, manager or Human Resources. I understand that if I do not follow the policies and procedures contained herein that I may be subject to disciplinary action, up to and including termination of employment.',
        'I also understand that this Handbook is the most up-to-date version of the Company\'s policies and procedures and replaces any prior written and oral communications about the subjects contained in it.',
        'I acknowledge that my employment relationship with the Company is "at-will", meaning that, regardless of anything contained in this Handbook and regardless of any custom or practice, either I or the Company may terminate my employment at any time, for any reason or no reason, with or without cause, and with or without procedural requirements. I understand that no representatives of the Company, other than the CEO in a writing signed by him/her/them, may enter into any agreements, or make any representations, written or oral, to alter my at-will status or otherwise create any contractual obligation between me and the Company.',
        'I further acknowledge that this handbook and the policies contained herein are not intended to create (and shall not be construed as creating) a contract (express or implied) for employment between the Company and any Teammate and that said policies can be modified by the Company at any time, with or without notice to me, in its sole and absolute discretion.',
        'By signing below, I acknowledge that I have received and will abide by the Company\'s Handbook and all the policies within it, including those on harassment, discrimination, retaliation, and bringing complaints regarding the same.'
      ];
      paras.forEach(p => { const lines = doc.splitTextToSize(p, contentW); doc.text(lines, margin, y); y += lines.length * 4.2 + 4; });
      y += 4;

      doc.setFillColor(241, 245, 249); doc.roundedRect(margin, y, contentW, 14, 2, 2, 'F');
      doc.setFont('helvetica', 'italic'); doc.setFontSize(8); doc.setTextColor(100, 116, 139);
      const ct = 'The signee agreed that their digital signature is the legal equivalent of a handwritten signature and that they intend to be bound by this acknowledgement.';
      doc.text(doc.splitTextToSize(ct, contentW - 8), margin + 4, y + 5); y += 20;

      doc.setFont('helvetica', 'bold'); doc.setFontSize(11); doc.setTextColor(13, 59, 59);
      doc.text('Teammate Signature', margin, y); y += 8;

      doc.setFont('helvetica', 'normal'); doc.setFontSize(8); doc.setTextColor(107, 114, 128);
      doc.text('PRINTED TEAMMATE NAME', margin, y); y += 5;
      doc.setFont('helvetica', 'bold'); doc.setFontSize(12); doc.setTextColor(31, 41, 55);
      doc.text(nameInput.value.trim(), margin, y); y += 3;
      doc.setDrawColor(209, 213, 219); doc.setLineWidth(0.4); doc.line(margin, y, margin + 80, y); y += 10;

      doc.setFont('helvetica', 'normal'); doc.setFontSize(8); doc.setTextColor(107, 114, 128);
      doc.text('TEAMMATE SIGNATURE', margin, y); y += 3;
      doc.addImage(canvas.toDataURL('image/png'), 'PNG', margin, y, 70, 25); y += 27;
      doc.line(margin, y, margin + 80, y); y += 10;

      doc.setFontSize(8); doc.setTextColor(107, 114, 128); doc.text('DATE', margin, y); y += 5;
      doc.setFont('helvetica', 'normal'); doc.setFontSize(11); doc.setTextColor(31, 41, 55);
      doc.text(new Date(dateInput.value + 'T12:00:00').toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }), margin, y);
      y += 3; doc.line(margin, y, margin + 50, y);

      const footerY = doc.internal.pageSize.getHeight() - 12;
      doc.setDrawColor(209, 213, 219); doc.setLineWidth(0.3); doc.line(margin, footerY - 4, pageW - margin, footerY - 4);
      doc.setFont('helvetica', 'normal'); doc.setFontSize(7); doc.setTextColor(156, 163, 175);
      doc.text('\u00A9 2025 Advantage Solutions Inc.  |  Confidential', margin, footerY);
      doc.text('Page 55 of 56', pageW - margin, footerY, { align: 'right' });

      const safeName = nameInput.value.trim().replace(/[^a-zA-Z0-9]/g, '_');
      pdfFileName = `Handbook_Ack_${safeName}_${dateInput.value.replace(/-/g, '')}.pdf`;
      generatedPDF = doc;
    }

    /* ═══════════════════════════════════════════════════════════
       SUBMIT
       ═══════════════════════════════════════════════════════════ */
    function handleSubmit() {
      let err = false;
      if (!nameInput.value.trim()) { document.getElementById('nameRow').classList.add('error'); err = true; } else { document.getElementById('nameRow').classList.remove('error'); }
      if (!hasSig) { document.getElementById('sigRow').classList.add('error'); err = true; } else { document.getElementById('sigRow').classList.remove('error'); }
      if (!dateInput.value) { document.getElementById('dateRow').classList.add('error'); err = true; } else { document.getElementById('dateRow').classList.remove('error'); }
      if (err) return;

      generatePDF();
      const fd = new Date(dateInput.value + 'T12:00:00').toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
      document.getElementById('signerDetail').innerHTML = `<span><strong>Name:</strong> ${nameInput.value.trim()}</span><span><strong>Date:</strong> ${fd}</span><span><strong>File:</strong> ${pdfFileName}</span>`;

      const odBtn = document.getElementById('onedriveSaveBtn');
      const odSt = document.getElementById('onedriveStatus');
      if (!ONEDRIVE_CLIENT_ID || typeof OneDrive === 'undefined') {
        odBtn.style.opacity = '0.5'; odBtn.style.cursor = 'not-allowed';
        odSt.textContent = 'OneDrive integration pending \u2014 app registration required';
      } else { odBtn.style.opacity = '1'; odBtn.style.cursor = 'pointer'; odSt.textContent = ''; }

      document.getElementById('saveOverlay').classList.add('show');
    }

    /* ═══════════════════════════════════════════════════════════
       ONEDRIVE SAVE
       ═══════════════════════════════════════════════════════════ */
    function saveToOneDrive() {
      if (!ONEDRIVE_CLIENT_ID) { alert('OneDrive integration is not configured yet.\n\nAn Azure AD App Registration (Client ID) is required.\nUse "Download PDF" for now.'); return; }
      if (typeof OneDrive === 'undefined') { alert('OneDrive SDK not loaded.\n\nEnsure the OneDrive.js script tag is uncommented in the HTML head.'); return; }

      const pdfBlob = generatedPDF.output('blob');
      const file = new File([pdfBlob], pdfFileName, { type: 'application/pdf' });
      const dt = new DataTransfer(); dt.items.add(file);
      document.getElementById('hiddenFileInput').files = dt.files;

      OneDrive.save({
        clientId: ONEDRIVE_CLIENT_ID,
        action: 'save',
        sourceInputElementId: 'hiddenFileInput',
        fileName: pdfFileName,
        openInNewWindow: true,
        advanced: { redirectUri: window.location.href },
        success: function() { document.getElementById('onedriveStatus').textContent = '\u2705 Saved to OneDrive successfully.'; document.getElementById('onedriveStatus').style.color = '#16a34a'; },
        cancel: function() { document.getElementById('onedriveStatus').textContent = 'Save cancelled.'; },
        error: function(e) { console.error('OneDrive error:', e); document.getElementById('onedriveStatus').textContent = 'Error saving \u2014 try downloading instead.'; document.getElementById('onedriveStatus').style.color = '#ef4444'; }
      });
    }

    function downloadPDF() { if (generatedPDF) generatedPDF.save(pdfFileName); }
    function closeSaveOverlay() { document.getElementById('saveOverlay').classList.remove('show'); }
    checkForm();
  </script>
</body>
</html>
